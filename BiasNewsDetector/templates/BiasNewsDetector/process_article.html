{% extends "BiasNewsDetector/base.html" %}
{% load static %}

{% block content %}
<body>
<div class="content-section">
    <h1 style="text-align: center">FINISHED PROCESSING</h1>
    <br>

    <h2 style="text-align: center; padding-bottom: 4%">{{ news_title }}</h2>
    {% if all_sides_bias and all_sides_source and all_sides_url %}
        {% if all_sides_bias != "Center" %}
            <h4><i style="text-align: left">
                According to ALLSides, {{ all_sides_source }} has a multipartisan vote of news articles within this website tends to {{ all_sides_bias }}.
                For more information, please visit the link below:
            </i></h4>
            <a href="{{ all_sides_url }}" style="padding-bottom: 25px">{{ all_sides_url }}</a>
            <br>
        {% else %}
            <h4><i style="text-align: left">
                According to ALLSides, {{ all_sides_source }} has a multipartisan vote of being {{ all_sides_bias }}, or unbias on most, if not all, news articles posted.
                For more information, please visit the link below:
            </i></h4>
            <a href="{{ all_sides_url }}" style="padding-bottom: 25px">{{ all_sides_url }}</a>
            <br>
        {% endif %}
    {% endif %}
    <br>
    {% for result in analysis_results %}
        <span class="{{ result.sentiment }}"
        {% if result.sentiment != "Neutral" %}
            title="{{ result.sentiment }} sentiment detected{% if result.entity|length > 0 %} towards entities:{% for ent in result.entity %}&#013;'{{ ent }}'{% endfor %}{% endif %}"
        {% endif %}
        >{{ result.sentence }}&nbsp</span>
    {% endfor %}
    <br>
    <h1>SUBMIT FEEDBACK HERE</h1>
    <p><strong>
        If you feel as though we had made a mistake by incorrectly labeling a sentence(s) bias.
        Please fill out the appropriate amount of forms below to help retrain our AI models to be more accurate in the future.
    </strong></p>
    <form action="{% url 'feedback_submission' %}" method="post">
        {% csrf_token %}
        <input type="hidden" name="website_url" value="{{ website_url }}">
        <input type="hidden" name="news_text" value="{{ news_text }}">
        <input type="hidden" name="all_sentences" value="{{ analysis_results }}">

        <div id="form-container">
            <!-- This section will be empty initially and will be filled with cloned forms -->
        </div>

        <!-- Hidden template for cloning -->
        <div id="form-template" style="display: none;">
            <div class="form-section">
                <div class="solid-line"></div>
                <label for="sent">Sentence:</label><br>
                <input type="text" class="sentence" name="sentence[]" id='sent' placeholder="Copy and paste a sentence here..."><br>
                <br>
                <label for="output">Bias Analysis Output:</label><br>
                <select class="output_analysis select-style" name="output_analysis[]" id="output">
                    <option value="Positive">Positive</option>
                    <option value="Negative">Negative</option>
                    <option value="Neutral">Neutral</option>
                </select><br>
                <label for="correct">Correct Bias Analysis:</label><br>
                <select class="correct_analysis select-style" name="correct_analysis[]" id="correct">
                    <option value="Positive">Positive</option>
                    <option value="Negative">Negative</option>
                    <option value="Neutral">Neutral</option>
                </select><br>
                <button type="button" class="delete-form secondary-button">Delete Feedback Prompt</button><br>
            </div>
        </div>
        <div class="solid-line"></div>
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%">
        <button type="button" id="add-form" class=" add-form secondary-button" data-inline="True">Add Feedback Prompt</button>
        <input type="submit" value="Submit Feedback" class="button" data-inline="True" style="text-align: right">
            </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('add-form').addEventListener('click', function() {
        var container = document.getElementById('form-container');
        var template = document.getElementById('form-template').getElementsByClassName('form-section')[0];
        var clone = template.cloneNode(true); // Clone from the template

        // Clear input values in the clone
        clone.querySelector('.sentence').value = '';
        clone.querySelectorAll('select').forEach(select => select.selectedIndex = 0);

        // Make the clone visible and append it to the container
        clone.style.display = "block";
        container.appendChild(clone);

        // Attach event listener to the delete button in the cloned section
        clone.querySelector('.delete-form').addEventListener('click', function() {
            this.parentNode.remove(); // Remove the parent .form-section
        });
    });

    // Optionally, initially add one form on page load
    document.getElementById('add-form').click();
});
</script>
</body>
{% endblock %}
